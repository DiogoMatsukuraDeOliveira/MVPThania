<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Auth - Gerenciador de Eventos</title>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #3366CC;
      --accent: #FF6F61;
      --dark: #1F2A44;
      --light: #F7F9FC;
    }
    body { font-family: 'Montserrat', sans-serif; background: var(--light); color: var(--dark); }
    .card { max-width: 840px; margin: 64px auto; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .nav-tabs .nav-link.active { background-color: var(--primary); color: #fff; }
    .nav-tabs .nav-link { color: var(--dark); }
    .table td, .table th { vertical-align: middle; }

    /* Botões padronizados como no app */
    .btn { border-radius: 10px; transition: background .2s, transform .2s; }
    .btn-primary, .btn-success {
      background: var(--primary);
      border: none;
    }
    .btn-primary:hover, .btn-success:hover {
      background: #274b8a;
      transform: translateY(-1px);
    }
    .btn-outline-danger {
      color: var(--accent);
      border-color: var(--accent);
    }
    .btn-outline-danger:hover {
      background: var(--accent);
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="card">
    <ul class="nav nav-tabs mb-3" id="authTab" role="tablist">
      <li class="nav-item">
        <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button">
          Login
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button">
          Cadastro
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="approve-tab" data-bs-toggle="tab" data-bs-target="#approve" type="button" disabled>
          Aprovação
        </button>
      </li>
    </ul>

    <div class="tab-content">
      <!-- LOGIN -->
      <div class="tab-pane fade show active" id="login" role="tabpanel">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">ID do Gestor</label>
              <input type="text" id="loginId" class="form-control" placeholder="Seu ID">
            </div>
            <div class="mb-3">
              <label class="form-label">Senha</label>
              <input type="password" id="loginPass" class="form-control" placeholder="Senha">
            </div>
            <div class="d-grid gap-2">
              <button class="btn btn-primary" id="btnLogin">Entrar</button>
              <button class="btn btn-outline-secondary" id="btnLoginSemCadastro">Entrar como convidado</button>
            </div>
            <small class="text-muted d-block mt-2">
              Dica: ADMIN / minhaSenhaSuperSecreta libera a aba de Aprovação.
            </small>
          </div>
          <div class="col-md-6">
            <div class="alert alert-info">
              <strong>Como funciona:</strong><br>
              • Gestores se cadastram e entram no app para criar/gerenciar eventos.<br>
              • Profissionais se candidatam no app (index) e ficam pendentes aqui.<br>
              • Faça login como <strong>ADMIN</strong> para aprovar/reprovar candidatos.<br>
              • Aprovados aparecem automaticamente na aba <em>Profissionais</em> do app.
            </div>
          </div>
        </div>
      </div>

      <!-- CADASTRO -->
      <div class="tab-pane fade" id="register" role="tabpanel">
        <div class="mb-3">
          <label class="form-label">Nome do Gestor</label>
          <input type="text" id="regName" class="form-control" placeholder="Seu nome">
        </div>
        <div class="mb-3">
          <label class="form-label">Senha</label>
          <input type="password" id="regPass" class="form-control" placeholder="Senha">
        </div>
        <button class="btn btn-primary w-100" id="btnRegister">Cadastrar</button>
      </div>

      <!-- APROVAÇÃO (ADMIN) -->
      <div class="tab-pane fade" id="approve" role="tabpanel">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h5 class="mb-0">Candidatos pendentes</h5>
          <div class="d-flex gap-2">
            <a href="index.html" class="btn btn-outline-secondary">Abrir app</a>
            <button class="btn btn-outline-danger" id="btnAdminLogout">Sair do modo admin</button>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Foto</th>
                <th>Nome</th>
                <th>Idade</th>
                <th>Ocupação</th>
                <th>Contato</th>
                <th>Currículo</th>
                <th style="width:220px">Ações</th>
              </tr>
            </thead>
            <tbody id="pendingList">
              <!-- preenchido via JS -->
            </tbody>
          </table>
        </div>
        <p class="text-muted" id="noPending" style="display:none">Nenhum candidato pendente.</p>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const ADMIN_ID   = 'ADMIN';
    const ADMIN_PASS = 'minhaSenhaSuperSecreta';

    function getUsers() { return JSON.parse(localStorage.getItem('users')||'[]'); }
    function saveUsers(u) { localStorage.setItem('users', JSON.stringify(u)); }

    function getProfessionals() {
      return JSON.parse(localStorage.getItem('professionals') || '[]');
    }
    function saveProfessionals(list) {
      localStorage.setItem('professionals', JSON.stringify(list));
    }

    function formatContactAnchor(input='') {
      const s = input.trim();
      if (!s) return '—';
      if (s.includes('@')) return `<a href="mailto:${s}">${s}</a>`;
      const digits = s.replace(/\D/g, '');
      if (digits.length >= 10) {
        const withCountry = digits.startsWith('55') ? digits : '55' + digits;
        return `<a target="_blank" href="https://wa.me/${withCountry}">${s}</a>`;
      }
      return s;
    }

    function enableApprovalTab() {
      const tabBtn = document.getElementById('approve-tab');
      tabBtn.removeAttribute('disabled');
      new bootstrap.Tab(tabBtn).show();
      renderPending();
    }

    function renderPending() {
      const tbody = document.getElementById('pendingList');
      const noPending = document.getElementById('noPending');
      if (!tbody) return;

      const list = getProfessionals().filter(p => p.approved === false);
      tbody.innerHTML = '';

      if (list.length === 0) {
        noPending.style.display = 'block';
        return;
      }
      noPending.style.display = 'none';

      list.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
  <td>${p.photoData ? `<img src="${p.photoData}" style="width:48px;height:48px;object-fit:cover;border-radius:8px">` : '—'}</td>
  <td><strong>${p.name||'—'}</strong></td>
  <td>${p.age ?? '—'}</td>
  <td>${p.occupation||'—'}</td>
  <td>${p.contact ? formatContactAnchor(p.contact) : '—'}</td>
  <td>
    ${p.cvData
      ? `<a href="${p.cvData}" download="${(p.name||'curriculo')}.pdf" class="btn btn-outline-primary btn-compact">Baixar PDF</a>`
      : '—'}
  </td>
  <td class="text-nowrap">
    <button class="btn btn-primary btn-compact me-2">Aprovar</button>
    <button class="btn btn-outline-danger btn-compact">Reprovar</button>
  </td>
`;

        const [btnApprove, btnReject] = tr.querySelectorAll('button');
        btnApprove.addEventListener('click', () => approveCandidate(p.id));
        btnReject.addEventListener('click', () => rejectCandidate(p.id));
        tbody.appendChild(tr);
      });
    }

    function approveCandidate(id) {
      const list = getProfessionals();
      const idx = list.findIndex(p => p.id === id);
      if (idx >= 0) {
        list[idx].approved = true;
        saveProfessionals(list);
        renderPending();
        alert('Profissional aprovado! Ele aparecerá na aba "Profissionais" do app.');
      }
    }

    function rejectCandidate(id) {
      const list = getProfessionals();
      const idx = list.findIndex(p => p.id === id);
      if (idx >= 0) {
        if (confirm('Tem certeza que deseja reprovar e remover este candidato?')) {
          list.splice(idx, 1);
          saveProfessionals(list);
          renderPending();
          alert('Candidatura removida.');
        }
      }
    }

    document.getElementById('btnRegister').addEventListener('click', () => {
      const name = document.getElementById('regName').value.trim();
      const pass = document.getElementById('regPass').value;
      if (!name || !pass) return alert('Preencha nome e senha');
      const users = getUsers();
      const id = 'GESTOR' + Date.now();
      users.push({ id, name, pass });
      saveUsers(users);
      alert(`Cadastro realizado! Seu ID: ${id}`);
      new bootstrap.Tab(document.getElementById('login-tab')).show();
      document.getElementById('loginId').value = id;
    });

    document.getElementById('btnLogin').addEventListener('click', () => {
      const id = document.getElementById('loginId').value.trim();
      const pass = document.getElementById('loginPass').value;

      if (id === ADMIN_ID && pass === ADMIN_PASS) {
        localStorage.setItem('currentUser', ADMIN_ID);
        enableApprovalTab();
        return;
      }

      const usr = getUsers().find(u => u.id === id && u.pass === pass);
      if (usr) {
        localStorage.setItem('currentUser', id);
        location.href = 'index.html';
      } else {
        alert('ID ou senha inválidos');
      }
    });

    document.getElementById('btnLoginSemCadastro').addEventListener('click', () => {
      localStorage.setItem('currentUser', 'convidado');
      location.href = 'index.html';
    });

    document.getElementById('btnAdminLogout')?.addEventListener('click', () => {
      localStorage.removeItem('currentUser');
      document.getElementById('approve-tab').setAttribute('disabled', 'true');
      new bootstrap.Tab(document.getElementById('login-tab')).show();
    });
  </script>
</body>
</html>
